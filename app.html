<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no" />
  <title>Metropolitano de Lima</title>
  <meta name="description" content="Información de rutas y servicios del Metropolitano, un sistema de transporte público en Lima, Perú.">
  <!-- Building blocks -->
  <link rel="stylesheet" href="style/action_menu.css">
  <link rel="stylesheet" href="style/buttons.css">
  <link rel="stylesheet" href="style/confirm.css">
  <link rel="stylesheet" href="style/edit_mode.css">
  <link rel="stylesheet" href="style/headers.css">
  <link rel="stylesheet" href="style/input_areas.css">
  <link rel="stylesheet" href="style/status.css">
  <link rel="stylesheet" href="style/switches.css">
  <!--link rel="stylesheet" href="style_unstable/drawer.css"-->
  <link rel="stylesheet" href="style_unstable/lists.css">
  <link rel="stylesheet" href="style_unstable/progress_activity.css">
  <link rel="stylesheet" href="style_unstable/scrolling.css">
  <link rel="stylesheet" href="style_unstable/seekbars.css">
  <link rel="stylesheet" href="style_unstable/tabs.css">
  <link rel="stylesheet" href="style_unstable/toolbars.css">

  <!-- Icons -->
  <link rel="stylesheet" href="icons/styles/action_icons.css">
  <link rel="stylesheet" href="icons/styles/media_icons.css">
  <link rel="stylesheet" href="icons/styles/comms_icons.css">

  <!-- Transitions -->
  <link rel="stylesheet" href="transitions.css">
  
  <!-- Util CSS: some extra tricks -->
  <link rel="stylesheet" href="util.css">
  <link rel="stylesheet" href="fonts.css">

  <!-- Additional markup to make Building Blocks kind of cross browser -->
  <link rel="stylesheet" href="cross_browser.css">

  <style>

    iframe {
      border: none;
      height: 100%;
      width: 100%;
    }

    [data-position="right"] {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      transform: translateX(100%);
      -webkit-transform: translateX(100%);
      z-index: 15;
      z-index: 100; /* -> drawer */
    }
    [data-position="right"].current {
      animation: rightToCurrent 0.4s forwards;
      -webkit-animation: rightToCurrent 0.4s forwards;
    }
    [data-position="right"].right {
      animation: currentToRight 0.4s forwards;
      -webkit-animation: currentToRight 0.4s forwards;
    }
    [data-position="current"].left {
      animation: currentToLeft 0.4s forwards;
      -webkit-animation: currentToLeft 0.4s forwards;
    }
    [data-position="current"].current {
      animation: leftToCurrent 0.4s forwards;
      -webkit-animation: leftToCurrent 0.4s forwards;
    }
    [data-position="back"] {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: -1;
      opacity: 0;
      /* z-index: 100; -> drawer */
    }
    [data-position="back"].fade-in {
      z-index: 120;
      animation: fadeIn 0.2s forwards;
      -webkit-animation: fadeIn 0.2s forwards;
    }
    [data-position="back"].fade-out {
      animation: fadeOut 0.2s forwards;
      -webkit-animation: fadeOut 0.2s forwards;
    }

    [data-position="edit-mode"] {
      position: absolute;
      top: -5rem;
      left: 0;
      right: 0;
      bottom: -7rem;
      z-index: -1;
      opacity: 0;
      transition: all 0.3s ease;
    }
    [data-position="edit-mode"].edit {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 20;
      opacity: 1;
    }
    [data-position="edit-mode"] iframe {
      pointer-events: none;
    }

    #scrolling iframe {
      top: -5rem;
    }

    #headers section[role="region"] {
      margin-bottom: 1.5rem;
    }

    #headers article section[role="region"] {
      display: inline;
    }

    #headers section[role="region"] article header:first-child {
      margin-top: 1.5rem;
    }

    #headers section[role="region"] header h2 {
      margin: 0 0 1.5rem 0;
    }

    #switches label:last-child {
      margin-left: 2rem;  
    }

    /* Scrolling */
    nav[data-type="scrollbar"] {
      padding-top: 1rem;
    }

    nav[data-type="scrollbar"] p {
      opacity: 1;
    }

    div[role="slider"] > label.icon {
      background: no-repeat right top;
      background-size: 3rem auto;
    }
    
    [data-type="list"] li {
      height: auto;
    }
    [data-type="list"] li p {
      white-space: normal;
    }
    section[role="region"] > .content [data-type="list"] li > p {
      margin: 0px 1.5rem 0px 3.5rem;
    }
  </style>
</head>
<body>
  <section role="region" id="index" data-position="current">
    <header class="fixed">
      <h1>Metropolitano de Lima</h1>
    </header>
    <article class="content scrollable header">
      <div data-type="list">
        <ul>
          <li>
            <a href="javascript:showstations()">
              <aside class='icon comms-icon contacts-sms'></aside>
              <p>Estaciones principales</p>
            </a>
          </li>
          <li>
            <a href="javascript:showfavoritestations()">
              <aside class='icon comms-icon contacts-favorite'></aside>
              <p>Estación favorita</p>
            </a>
          </li>
          <li>
            <a href="javascript:showneareststations()">
              <aside class='icon comms-icon contacts-location'></aside>
              <p>Estación más cercana</p>
            </a>
          </li>
          <li>
            <a href="javascript:showtweets()">
              <aside class='icon comms-icon contacts-twitter'></aside>
              <p>Alertas en Twitter</p>
            </a>
          </li>
          <li>
            <a href="javascript:showinformation()">
              <aside class='icon comms-icon contacts-phone'></aside>
              <p>Información general</p>
            </a>
          </li>
          <li>
            <a href="javascript:showabout()">
              <aside class='icon comms-icon contacts-email'></aside>
              <p>Acerca de la aplicación</p>
            </a>
          </li>
        </ul>
      </div>
    </article>
  </section> <!-- end index -->

  <!--····························· Stations ·····························-->
  <section id="stations" data-position="right">
     <section role="region">
      <header class="fixed">
        <a id="btn-stations-back" href="#"><span class="icon icon-back">back</span></a>
        <h1>Estaciones principales</h1>
      </header>
      <article class="content scrollable header">
        <section data-type="list" id="list-of-stations">
        </section>
      </article>
    </section>
  </section>

  <!--·························· Remove all favorite stations ··························-->
  <section id="remove-favorite-stations" data-position="back" class="fullscreen">
    <form role="dialog" data-type="confirm">
      <section>
        <h1>Confirmación</h1><!-- this heading is optional -->
        <p>¿Está seguro de eliminar su estación favorita?</p>
      </section>
      <menu>
        <button>Cancelar</button>
        <button class="danger" formaction="javascript:confirmremoveallfavorites()">Borrar estación</button>
      </menu>
    </form>
  </section>

  <!--····························· Favorite Station ·····························-->
  <section id="favorite-stations" data-position="right">
     <section role="region">
      <header class="fixed">
        <a id="btn-favorite-back" href="#"><span class="icon icon-back">back</span></a>
        <h1>Estación favorita</h1>
      </header>
      <article class="content scrollable header">
        <section data-type="list" id="list-of-favorite-stations">
        </section>
      </article>
    </section>
  </section>

  <!--····························· Nearest Station ·····························-->
  <section id="nearest-stations" data-position="right">
     <section role="region">
      <header class="fixed">
        <a id="btn-nearest-back" href="#"><span class="icon icon-back">back</span></a>
        <h1>Estación más cercana</h1>
      </header>
      <article class="content scrollable header">
        <section data-type="list" id="list-of-nearest-stations">
        </section>
      </article>
    </section>
  </section>

  <!--····························· Station Details ·····························-->
  <section id="station" data-position="right">
     <section role="region">
      <header class="fixed">
        <a id="btn-station-back" href="#"><span class="icon icon-back">back</span></a>
        <h1>Datos de estación</h1>
      </header>
      <article class="content scrollable header">
        <section data-type="list" id="station-details">
        </section>
      </article>
    </section>
  </section>

  <!--····························· Tweets ·····························-->
  <section id="tweets" data-position="right">
     <section role="region">
      <header class="fixed">
        <a id="btn-tweets-back" href="#"><span class="icon icon-back">back</span></a>
        <h1>Alertas en Twitter</h1>
      </header>
      <article class="content scrollable header">
        <section data-type="list" id="list-of-tweets">
        </section>
      </article>
    </section>
  </section>
  
  <!--····························· Service information ·····························-->
  <section id="info" data-position="right">
     <section role="region">
      <header class="fixed">
        <a id="btn-info-back" href="#"><span class="icon icon-back">back</span></a>
        <h1>Información general</h1>
      </header>
      <article class="content scrollable header">
        <section data-type="list" id="info-details">
          <p>Horario de atención</p>
          <p class="small">De 5:50 a 23:00 horas</p>
          <p>Tarifas en red Troncal</p>
          <p class="small">Normal: S/. 2.00<br>Universitario: S/. 1.00 (*)<br>Escolar: S/. 1.00 (*)<br>(*) Con tarjeta preferencial</p>
          <p>Tarifas en red Alimentadores</p>
          <p class="small">Normal: S/. 1.00<br>Universitario: S/. 0.50 (*)<br>Escolar: S/. 0.50 (*)<br>(*) Con tarjeta preferencial</p>
          <p>Canales Virtuales de atención</p>
          <p class="small">Call Center: <a href="tel:+5112039000">(01)2039000</a>
          <br>Atención: L-V: 06-22 horas, S-D-F: 07-22 horas
          <br>Correo: <a href="mailto:atencionalusuario@protransporte.gob.pe">atencionalusuario@protransporte.gob.pe</a>
        </section>
      </article>
    </section>
  </section>
  
  <!--····························· About information ·····························-->
  <section id="about" data-position="right">
     <section role="region">
      <header class="fixed">
        <a id="btn-about-back" href="#"><span class="icon icon-back">back</span></a>
        <h1>Acerca de la aplicación</h1>
      </header>
      <article class="content scrollable header">
        <section data-type="list" id="info-details">
          <p>Importante</p>
          <p class="small">Ni esta aplicación ni su autor guardan relación con la Municipalidad de Lima.</p>
          <p>Autor</p>
          <p class="small"><a href="https://reps.mozilla.org/u/jesanchez/" target="_blank">Juan Eladio Sánchez Rosas</a><br>(<a href="http://mozilla.pe/" target="_blank">Mozilla Perú</a>)</p>
          <p>Código de la aplicación</p>
          <p class="small">Proyecto y peticiones <a href="https://github.com/juaneladio/metropolitano">GitHub</a>.</p>
          <p>Transporte en Lima</p>
          <p class="small">Otra aplicación de transporte en Lima: 
          <br>- <a href="https://marketplace.firefox.com/app/subealmetrodelima/" target="_blank">Sube al Metro de Lima</a></p>
        </section>
      </article>
    </section>
  </section>

  <script type="text/javascript" defer src="js/status.js"></script>
  <script type="text/javascript" defer src="js/codebird-js-2.4.3/sha1.js"></script>
  <script type="text/javascript" defer src="js/codebird-js-2.4.3/codebird.js"></script>
  <script type="text/javascript" defer src="js/latlong.js"></script>
  <script>
    
// A. Datos generales del sistema de transporte
    
var transportationData = {
	stations: {
		name: "Estaciones principales",
		items: [
		{ /* 0 */ name: "Naranjal", address: "Av. Túpac Amaru cdra 45 con Av. Chinchaysuyo cdra 1 - Independencia", coordinatelat: "-11.982013", coordinatelng: "-77.058663", },
		{ /* 1 */ name: "Izaguirre", address: "Av. Túpac Amaru cdra 37 con Av. C Izaguirre cdra 1 - Independencia", coordinatelat: "-11.988667", coordinatelng: "-77.056915", },
		{ /* 2 */ name: "Pacífico", address: "Av. Túpac Amaru cdra 35 con Av. Pacífico cdra 1 - Independencia", coordinatelat: "-11.994166", coordinatelng: "-77.056207", },
		{ /* 3 */ name: "Independencia", address: "Av. Túpac Amaru cdra 33 con Av. Los Pinos cdra 1 - Independencia", coordinatelat: "-11.997383", coordinatelng: "-77.055225", },
		{ /* 4 */ name: "Jazmines", address: "Av. Túpac Amaru cdra 72 con Av. Los Jazmines cdra 1 - Independencia", coordinatelat: "-12.002236", coordinatelng: "-77.054719", },
		{ /* 5 */ name: "Tomás Valle", address: "Av. Túpac Amaru con Av. Tomás Valle cdra 1 - Independencia", coordinatelat: "-12.007316", coordinatelng: "-77.053793", },
		{ /* 6 */ name: "El Milagro", address: "Av. Túpac Amaru cdra 14 con Av. Bartolomé cdra 1 - San Martín de Porres/Independencia", coordinatelat: "-12.010883", coordinatelng: "-77.053041", },
		{ /* 7 */ name: "Honorio Delgado", address: "Av. Túpac Amaru cdra 8 con Av. - Honorio Delgado cdra 1 - San Martín de Porres/Independencia", coordinatelat: "-12.018145", coordinatelng: "-77.051475", },
		{ /* 8 */ name: "UNI", address: "Av. Túpac Amaru cdra 2 - San Martín de Porres/Rímac", coordinatelat: "-12.023329", coordinatelng: "-77.049930", },
		{ /* 9 */ name: "Parque del Trabajo", address: "Av. Caquetá cdra 7 con Antón Sánchez cdra 1 - San Martín de Porres/Rímac", coordinatelat: "-12.030884", coordinatelng: "-77.044158", },
		{ /* 10 */ name: "Caquetá", address: "Av. Caquetá cdra 1 con Av. Zarumilla cdra 1 - San Martín de Porres/Rímac", coordinatelat: "-12.036467", coordinatelng: "-77.043621", },
		{ /* 11 */ name: "Ramon Castilla", address: "Av. Emancipación cdra 9 con Jr. Tayacaja cdra 6, Cercado de Lima", coordinatelat: "-12.043373", coordinatelng: "-77.042721", },
		{ /* 12 */ name: "2 de Mayo", address: "Av. Alfonso Ugarte cdra 4 y 5 con Plaza Dos de Mayo, Cercado de Lima", coordinatelat: "-12.046330", coordinatelng: "-77.042785", },
		{ /* 13 */ name: "Quilca", address: "Av. Alfonso Ugarte cdra 9 con Jr. Pomabamba, Breña/Cercado de Lima", coordinatelat: "-12.050862", coordinatelng: "-77.042377", },
		{ /* 14 */ name: "España", address: "Av. Alfonso Ugarte cdra 13 con Av. República de Portugal, Breña/Cercado de Lima", coordinatelat: "-12.058138", coordinatelng: "-77.041765", },
		{ /* 15 */ name: "Tacna", address: "Av. Emancipación cdra 4 y 5 con Av. Tacna cdra 5, Cercado de Lima", coordinatelat: "-12.04633", coordinatelng: "-77.037445", },
		{ /* 16 */ name: "Jirón de la Unión", address: "Av. Emancipación cdra 1 Jr. de la Unión cdra 6, Cercado de Lima", coordinatelat: "-12.049050", coordinatelng: "-77.033110", },
		{ /* 17 */ name: "Colmena", address: "Av. Nicolás de Piérola (Colmena) cdra 11 con Jr. Lampa cdra 9, Cercado de Lima", coordinatelat: "2.052725", coordinatelng: "-77.033097", },
		{ /* 18 */ name: "Central", address: "Parque Los Héroes Navales con Av. Paseo de la República 170, Cercado de Lima", coordinatelat: "-12.057756", coordinatelng: "-77.035983", },
		{ /* 19 */ name: "Estadio Nacional", address: "Av. Paseo de la República cdra 9 con Puente Peatonal, Cercado de Lima/La Victoria", coordinatelat: "-12.068615", coordinatelng: "-77.032185", },
		{ /* 20 */ name: "Mexico", address: "Av. Paseo de la República cdra 13 con Puente México, Cercado de Lima/La Victoria", coordinatelat: "-12.076835", coordinatelng: "-77.028837", },
		{ /* 21 */ name: "Canadá", address: "Av. Paseo de la República cdra 19 con Puente Canadá, Lince/La Victoria", coordinatelat: "-12.082416", coordinatelng: "-77.026531", },
		{ /* 22 */ name: "Javier Prado", address: "Av. Paseo de la República cdra 28 con Puente Javier Prado, San Isidro", coordinatelat: "-12.090815", coordinatelng: "-77.022888", },
		{ /* 23 */ name: "Canaval y Moreira", address: "Av. Paseo de la República cdra 32 con Puente Canaval y Moreira, San Isidro", coordinatelat: "-12.096784", coordinatelng: "-77.025071", },
		{ /* 24 */ name: "Aramburú", address: "Av. Paseo de la República cdra 37 con Puente Aramburú, San Isidro", coordinatelat: "-12.102821", coordinatelng: "-77.027336", },
		{ /* 25 */ name: "Domingo Orué", address: "Av. Paseo de la República cdra 43 con Puente Domingo Oru&eacute, San Isidro", coordinatelat: "-12.108596", coordinatelng: "-77.026386", },
		{ /* 26 */ name: "Angamos", address: "Av. Paseo de la República cdra 48 con Puente Angamos, San Isidro", coordinatelat: "-12.113484", coordinatelng: "-77.025983", },
		{ /* 27 */ name: "Ricardo Palma", address: "Av. Paseo de la República cdra 55 con Puente Ricardo Palma, Miraflores/Surquillo", coordinatelat: "-12.119123", coordinatelng: "-77.025871", },
		{ /* 28 */ name: "Benavides", address: "Av. Paseo de la República cdra 59 con Puente Benavides, Miraflores", coordinatelat: "-12.125338", coordinatelng: "-77.024138", },
		{ /* 29 */ name: "28 de julio", address: "Av. Paseo de la República cdra 61 con Puente Miraflores, Miraflores", coordinatelat: "-12.129586", coordinatelng: "-77.022786", },
		{ /* 30 */ name: "Plaza de Flores", address: "Av. Rosendo Vidaurre cdra 5 y 6, Barranco", coordinatelat: "-12.135965", coordinatelng: "-77.018433", },
		{ /* 31 */ name: "Balta", address: "Av. República de Panamá (Bolognesi) cdra 10 con óvalo Balta, Barranco", coordinatelat: "-12.141722", coordinatelng: "-77.017797", },
		{ /* 32 */ name: "Bulevar", address: "Av. República de Panamá (Bolognesi) cdra 3 con calle Juan Pazos, Barranco", coordinatelat: "-12.148067", coordinatelng: "-77.020061", },
		{ /* 33 */ name: "Estadio Unión", address: "Av. Escuela Militar cdra 2 con Pasaje Anaya, Barranco", coordinatelat: "-12.152736", coordinatelng: "-77.019734", },
		{ /* 34 */ name: "Escuela Militar", address: "Av. Escuela Militar cdra 8, Chorrillos", coordinatelat: "-12.160800", coordinatelng: "-77.019128", },
		{ /* 35 */ name: "Terán", address: "Av. Prolongación Paseo de la República cdra 1 con Av. Fernando Terán cdra 8, Chorrillos", coordinatelat: "-12.168325", coordinatelng: "-77.018795", },
		{ /* 36 */ name: "Rosario de Villa", address: "Av. Prolongación Paseo de la República cdra 8 con Jr. Costa Azul, Chorillos", coordinatelat: "-12.173512", coordinatelng: "-77.014761", },
		{ /* 37 */ name: "Matellini", address: "Av. Prolongación Paseo de la República cdra 18 con Av. Ariosto Matellini, Chorillos", coordinatelat: "-12.178996", coordinatelng: "-77.009783", },
		]
	},
	routes: {
		name: "Rutas disponibles",
		items: [
		{ name: "Regular A", days: [0,1,2,3,4,5,6], times: ["0520","2200"], stations: [0,1,2,3,4,5,6,7,8,9,10,11,15,16,17,18], },
		{ name: "Regular B", days: [0,1,2,3,4,5,6], times: ["0520","2200"], stations: [0,1,2,3,4,5,6,7,8,9,10,12,13,14,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37], },
		{ name: "Regular C", days: [0,1,2,3,4,5,6], times: ["0520","2200"], stations: [11,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37], },
		{ name: "Expreso 1: Naranjal a Matellini", days: [1,2,3,4,5], times: ["0600","0900","1650","2100"], stations: [0,8,10,12,13,14,18,22,23,26,31,32,33,34,35,36,37], },
		{ name: "Expreso 1: Matellini a Naranjal", days: [1,2,3,4,5], times: ["0630","0900","1700","2015"], stations: [0,8,10,12,13,14,18,22,23,26,31,32,33,34,35,36,37], },
		{ name: "Expreso 2: Naranjal a Plaza de Flores", days: [1,2,3,4,5], times: ["0605","0900","1650","2040"], stations: [0,5,8,10,18,22,23,26,30], },
		{ name: "Expreso 2: Plaza de Flores a Naranjal", days: [1,2,3,4,5], times: ["0630","0900","1700","2015"], stations: [0,5,8,10,18,22,23,26,30], },
		{ name: "Expreso 4", days: [6], times: ["0600","2100"], stations: [0,1,5,8,10,12,14,18,22,23,26,30], },		
		{ name: "Super Expreso: Naranjal a Plaza de Flores", days: [1,2,3,4,5], times: ["0635","0900"], stations: [0,23,26,30], },
		{ name: "Super Expreso: Plaza de Flores a Naranjal", days: [1,2,3,4,5], times: ["0635","0900"], stations: [0,18,23,26,30], },
		]
	},
};

// B. Saltos hacia atrás en páginas de la aplicación

  //info
  document.querySelector('#btn-info-back').addEventListener ('click', function () {
    document.querySelector('#info').className = 'right';
    document.querySelector('[data-position="current"]').className = 'current';
  });
  //about
  document.querySelector('#btn-about-back').addEventListener ('click', function () {
    document.querySelector('#about').className = 'right';
    document.querySelector('[data-position="current"]').className = 'current';
  });
  //stations
  document.querySelector('#btn-stations-back').addEventListener ('click', function () {
    document.querySelector('#stations').className = 'right';
    document.querySelector('[data-position="current"]').className = 'current';
  });
  //station
  document.querySelector('#btn-station-back').addEventListener ('click', function () {
    document.querySelector('#station').className = 'right';
    document.querySelector('[data-position="current"]').className = 'current';
  });
  //removefavoritestations
  document.querySelector('#remove-favorite-stations').addEventListener ('click', function () {
    this.className = 'fade-out';
  });
  //favoritestations
  document.querySelector('#btn-favorite-back').addEventListener ('click', function () {
    document.querySelector('#favorite-stations').className = 'right';
    document.querySelector('[data-position="current"]').className = 'current';
  });
  //neareststations
  document.querySelector('#btn-nearest-back').addEventListener ('click', function () {
    document.querySelector('#nearest-stations').className = 'right';
    document.querySelector('[data-position="current"]').className = 'current';
  });
  //tweets
  document.querySelector('#btn-tweets-back').addEventListener ('click', function () {
    document.querySelector('#tweets').className = 'right';
    document.querySelector('[data-position="current"]').className = 'current';
  });
    
// C. Funciones generales

  function makeLink(text) // this REGEX converts http(s) links that are embedded in the tweet text into real hyperlinks.
  {  
    var exp = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;  
    return text.replace(exp,"<a href='$1' target='_blank'>$1</a>");
  }

// D. Generadores de contenido para páginas 'dinámicas'

  function showinformation()
  {
    document.querySelector('#info').className = 'current';
	}
  
  function showabout()
  {
    document.querySelector('#about').className = 'current';
	}
  
  function showstations()
  {
    var htmlstations = "<ul>";
    var numberstations = transportationData.stations.items.length;
    for (var i=0; i<numberstations; i++)
    {
      htmlstations += "<li><a href='javascript:showstation("+i+",transportationData)'>";
      htmlstations += "<aside class='icon comms-icon contacts-location'></aside>";
      htmlstations += "<p>"+transportationData.stations.items[i].name+"</p></a></li>";
    }
    htmlstations += "</ul>";
    document.querySelector('#list-of-stations').innerHTML = htmlstations;
    document.querySelector('#stations').className = 'current';
	}
  
  function showstation(stationselected,transportationData)
  {
	  var htmlstation = "";
    htmlstation += "<ul><li><aside class='icon comms-icon contacts-location'></aside>";
    htmlstation += "<p>"+transportationData.stations.items[stationselected].name+"</p>";
    htmlstation += "<p>"+transportationData.stations.items[stationselected].address+"</p>";
    htmlstation += "</li></ul>";
    if (stationselected == localStorage.getItem("myfavoritestations"))
			htmlstation += "<div id='favoritebutton'><a role='button' href='javascript:removefavoritestation("+stationselected+",transportationData)'>Dejar de ser favorita</a></div>";
    else
      htmlstation += "<div id='favoritebutton'><a role='button' href='javascript:addfavoritestation("+stationselected+",transportationData)'>Fijar como favorita</a></div>";
    var today = new Date();
    var dayname = "";
    switch (today.getDay()) {
      case 0: dayname = "Domingo"; break
      case 1: dayname = "Lunes"; break
      case 2: dayname = "Martes"; break
      case 3: dayname = "Miércoles"; break
      case 4: dayname = "Jueves"; break
      case 5: dayname = "Viernes"; break
      case 6: dayname = "Sábado"; break
    }
    htmlstation += "<header>Servicios hoy "+dayname+"</header><ul>";
    var numberroutes = transportationData.routes.items.length;
    for (var i=0; i<numberroutes; i++)
    {
      if ( (transportationData.routes.items[i].days.indexOf(today.getDay())!==-1)
        && (transportationData.routes.items[i].stations.indexOf(stationselected)!==-1) )
      { htmlstation += "<li><aside class='icon comms-icon contacts-link'></aside><p>"+transportationData.routes.items[i].name+"</p><p>";
        var numbertimes = transportationData.routes.items[i].times.length;
        for (var j=0; j<numbertimes; j++)
        { if (j===0)
          { htmlstation += ""+transportationData.routes.items[i].times[j].toString()+"-"; }
          else if ( (j%2) === 0 )
          { htmlstation += ";"+transportationData.routes.items[i].times[j]+"-"; }
          else 
	        { htmlstation += ""+transportationData.routes.items[i].times[j]+""; }
        }
        htmlstation += "</p></li>";
      }
	  }
	  htmlstation += "</ul>";
    document.querySelector('#station-details').innerHTML = htmlstation;
	  document.querySelector('#station').className = 'current';
	  document.querySelector('[data-position="current"]').className = 'left';
  }
  
  function addfavoritestation(stationselected,transportationData)
  {
    localStorage.setItem("myfavoritestations",stationselected);
    if ("mozNotification" in navigator)
    { // FirefoxOS
      var notification = navigator.mozNotification.createNotification(
        "Metropolitano de Lima",
        "Nueva estación favorita"
        );
      notification.onshow = function () { setTimeout(notification.close(), 1000); }
                    notification.show();
    }
    else
    if ("Notification" in navigator)
    { // Firefox +22
      var n = new Notification("Metropolitano de Lima",{body:"Nueva estación favorita"});
    }
    var htmlbutton = "<a role='button' href='javascript:removefavoritestation("+stationselected+",transportationData)'>Dejar de ser favorita</a>";
    document.querySelector('#favoritebutton').innerHTML =  htmlbutton;
  }
  
  function removefavoritestation(stationselected,transportationData)
  {
    localStorage.removeItem("myfavoritestations");
    var htmlbutton = "<a role='button' href='javascript:addfavoritestation("+stationselected+",transportationData)'>Fijar como favorita</a>";
    document.querySelector('#favoritebutton').innerHTML =  htmlbutton;
  }
  
  function confirmremoveallfavorites()
  {
		localStorage.removeItem('myfavoritestations');
		showfavoritestations();
	}
  
  function showfavoritestations()
  { 
    var favoritestation = localStorage.getItem("myfavoritestations");
    var htmlfavoritestations = "";
    if (favoritestation)
    { htmlfavoritestations = "<ul>";
      htmlfavoritestations += "<li><a href='javascript:showstation("+favoritestation+",transportationData)'>";
      htmlfavoritestations += "<aside class='icon comms-icon contacts-location'></aside>";
      htmlfavoritestations += "<p>"+transportationData.stations.items[favoritestation].name+"</p></a></li>";
      htmlfavoritestations += "</ul>";
      htmlfavoritestations += "<a role='button' href='javascript:removeallfavorites()'>Quitar favorita</a>";
    }
    else
    {
      htmlfavoritestations = "<ul><li><p>No hay estación favorita</p></li></ul>";
    }
    document.querySelector('#list-of-favorite-stations').innerHTML = htmlfavoritestations;
    document.querySelector('#favorite-stations').className = 'current';
  }
  
  function removeallfavorites()
  {
    document.querySelector('#remove-favorite-stations').className = 'fade-in';
  }
  
  function showneareststations()
  {
    if (!navigator.onLine)
    {
			document.querySelector('#list-of-tweets').innerHTML = "<p class='small'>Usted no está conectado a Internet.</p>";
			document.querySelector('#tweets').className = 'current';
		}
		else
    {
			document.querySelector('#list-of-nearest-stations').innerHTML = "<p class='small'>Por favor, espere un momento ... <progress></progress></p>";
			document.querySelector('#nearest-stations').className = 'current';
      if ("geolocation" in navigator)
      {
        var options = {
          enableHighAccuracy: true,
          timeout: 15000, //15 sec
          maximumAge: 0
          };
        function success(pos)
        {
          var crd = pos.coords;
          //console.log('Latitude : ' + crd.latitude);
          //console.log('Longitude: ' + crd.longitude);
          //console.log('More or less ' + crd.accuracy + ' meters.');
          var myLatLong = new LatLon(Geo.parseDMS(crd.latitude), Geo.parseDMS(crd.longitude));
          var numberstations = transportationData.stations.items.length;
          var min_distance;
          var neareststation;
          for (var i=0; i<numberstations; i++)
          {
            var current_station = new LatLon(Geo.parseDMS(transportationData.stations.items[i].coordinatelat), Geo.parseDMS(transportationData.stations.items[i].coordinatelng));
            //console.log(myLatLong);
            var current_distance = myLatLong.distanceTo(current_station);
            //console.log(current_distance);
            if (i==0)
            {
              min_distance = current_distance;
              neareststation = 0;
            }
            if (parseFloat(current_distance) < parseFloat(min_distance))
            {
              neareststation = i;
            }
          }
          var htmlneareststations = "";
          if (neareststation)
          { htmlneareststations = "<ul>";
            htmlneareststations += "<li><a href='javascript:showstation("+neareststation+",transportationData)'>";
            htmlneareststations += "<aside class='icon comms-icon contacts-location'></aside>";
            htmlneareststations += "<p>"+transportationData.stations.items[neareststation].name+"</p><p>"+min_distance +"Km aprox.</p></a></li>";
            htmlneareststations += "</ul>";
          }
          else
          {
            htmlneareststations = "<ul><li><p>No se puede determinar estación cercana.</p></li></ul>";
          }
          document.querySelector('#list-of-nearest-stations').innerHTML = htmlneareststations;
        };
        function error(err)
        {
          //console.warn('ERROR(' + err.code + '): ' + err.message);
          var htmlneareststations = "<p class='small'>Lo sentimos, no se pudo determinar su ubicación.</p>";
          document.querySelector('#list-of-nearest-stations').innerHTML = htmlneareststations;
        };
        navigator.geolocation.getCurrentPosition(success, error, options);
      }
      else
      {
        /* geolocation IS NOT available */
        var htmlneareststations = "<p class='small'>La geolocalización no está disponible en su equipo.</p>";
        document.querySelector('#list-of-nearest-stations').innerHTML = htmlneareststations;
      }
    }
	}
  
  function showtweets()
	{
		if (!navigator.onLine)
    {
			document.querySelector('#list-of-tweets').innerHTML = "<p class='small'>Usted no está conectado a Internet.</p>";
			document.querySelector('#tweets').className = 'current';
		}
		else
    {
			document.querySelector('#list-of-tweets').innerHTML = "<p class='small'>Por favor, espere un momento ... <progress></progress></p>";
			document.querySelector('#tweets').className = 'current';
			var cb = new Codebird;
			cb.setConsumerKey("SARefZOgzpapJ53OkZVw", "TskSVBlbiwC8YAoE5A8eCl95uSJug0GISQKvFBbC88I");
			cb.__call(
				"search_tweets",
				"q=from:MetropolitanoPT",
				function (reply)
        { //console.log(reply);
					// If there are answers
					reply_length = reply.statuses.length;
					if (reply_length > 0)
					{
					  var htmltweets = "";
					  htmltweets = "<ul>";
					  for (var i=0; i < reply_length; i++)
					  { //console.log(reply.statuses[i].text);
					    if (reply.statuses[i].text.charAt(0)!=='@')
					    {
                htmltweets += "<li><aside class='icon comms-icon contacts-twitter'></aside><p>MetropolitanoPT</p>";
                htmltweets += '<p class="small">'+makeLink(reply.statuses[i].text)+"</p></a></li>";
              }
					  }
					  htmltweets += "</ul>";
					  document.querySelector('#list-of-tweets').innerHTML = htmltweets;
					}
				},
        true // this parameter required by Codebird
			);
		}
	}
  
  </script>
</body>
</html>
